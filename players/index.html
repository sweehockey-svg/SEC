<body>

  <!-- Obligatoriska element -->
  <div id="playerName"></div>

  <img id="playerPhoto" />

  <div id="statsOutput"></div>

  <!-- Ditt script -->
 <script>
(async () => {

  // üîß BYT TILL DIN APP SCRIPT WEB-APP URL (slutar p√• /exec)
  const API_BASE = "https://script.google.com/macros/s/AKfycbwUvylvIbUTy4_zihW5_OKIsQME2vxcPHWLldObZI28dggqJytvF2UmdsAD4Ib5Zre1/exec";

  // h√§mta ?player=xxxx fr√•n URL
  const params = new URLSearchParams(window.location.search);
  const rawPlayer = (params.get("player") || "").trim();
  const norm = s => String(s||"").toLowerCase().replace(/\s+/g,"");

  if (!rawPlayer) {
    document.querySelector(".player-nick").textContent = "Ingen spelare vald";
    return;
  }

  const normalized = norm(rawPlayer);

  // dina s√§songer
  const seasons = [19.5, ...Array.from({length: 19},(_,i)=>19-i)];

  // alla 4 typer per s√§song
  const SHEETS = [];
  for (const s of seasons) {
    SHEETS.push({type:"goalie",name:`M√•lvaktsstats grupp ${s}`});
    SHEETS.push({type:"goalie",name:`M√•lvaktsstats slut ${s}`});
    SHEETS.push({type:"player",name:`Spelarstats grupp ${s}`});
    SHEETS.push({type:"player",name:`Spelarstats slut ${s}`});
  }

  // TEAM MAP
  const TEAM_MAP = { /* DIN STORA TEAM_MAP H√ÑR */ };

  // vi letar fr√•n h√∂gst ‚Üí l√§gst
  let found = null;

  for (const sh of SHEETS) {
    try {
      const res = await fetch(`${API_BASE}?sheet=${encodeURIComponent(sh.name)}&_t=${Date.now()}`);
      const rows = await res.json();
      if (!rows?.length) continue;

      // r√§tt kolumnnamn
      const nameCol = (sh.type === "goalie") ? "GOALIES" : "PLAYERS";

      for (const r of rows) {
        const cell = norm(r[nameCol]);
        if (!cell) continue;
        if (cell === normalized || cell.includes(normalized)) {

          found = {
            type: sh.type,
            season: sh.name,
            team: r["TEAM"] || "",
            data: r
          };

          break;
        }
      }

      if (found) break;

    } catch(err) {
      console.warn("Fel vid l√§sning:", sh.name, err);
    }
  }

  if (!found) {
    document.querySelector(".player-nick").textContent = rawPlayer;
    document.querySelector(".player-meta").textContent = "Ingen data hittad";
    return;
  }

  // TEAM-kod ‚Üí TEAM_MAP
  const teamName = TEAM_MAP[found.team] || found.team || "Ok√§nt lag";

  // uppdatera UI
  document.querySelector(".player-nick").textContent = rawPlayer;
  document.querySelector(".player-meta").textContent = teamName;

})();
</script>

  </body>
