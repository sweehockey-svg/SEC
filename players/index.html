<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Spelarkort ‚Äì Svenska eHockey Cupen</title>

<style>
    body {
        margin: 0;
        font-family: Inter, system-ui, Arial, sans-serif;
        background: #000;
        color: #fff;
        text-align: center;
        padding-bottom: 80px;
    }

    .header {
        padding: 30px;
        font-size: 1.8rem;
        font-weight: 900;
        letter-spacing: 0.08em;
        color: #f0d58b;
    }

    .player-photo {
        width: 240px;
        border-radius: 18px;
        border: 2px solid #d6b15f;
        box-shadow: 0 0 20px rgba(214, 177, 95, 0.6);
        margin-top: 10px;
        opacity: 0;
        transition: 0.6s;
    }
    .player-photo.loaded {
        opacity: 1;
    }

    .player-name {
        font-size: 2.5rem;
        font-weight: 800;
        margin: 18px 0 8px;
        background: linear-gradient(90deg,#fff,#f0d58b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .no-stats {
        margin: 40px auto;
        max-width: 600px;
        padding: 16px;
        border-radius: 10px;
        background: #1a0e0e;
        border-left: 4px solid red;
        color: #ffaaaa;
        font-size: 1rem;
    }

    .stats-table {
        margin: 40px auto;
        max-width: 800px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(255,255,255,0.1);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        color: #fff;
    }
    thead {
        background: #141b33;
        color: #f0d58b;
    }
    th, td {
        padding: 14px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
</style>
</head>

<body>

<div class="header">üèí Svenska eHockey Cupen ‚Äì Spelarkort</div>

<img class="player-photo" id="playerPhoto" src="" alt="Spelarbild" />

<h1 class="player-name" id="playerName"></h1>

<div id="statsOutput"></div>

<script>
// =======================================
// 1Ô∏è‚É£ API-URL (KLISRA IN NYA DEPLOY-URL:EN)
// =======================================
const API_BASE = "üí• KLISRA-IN-DITT-NYA-API-H√ÑR/exec";


// =======================================
// 2Ô∏è‚É£ H√§mta ?player=namn fr√•n URL
// =======================================
const urlParams = new URLSearchParams(window.location.search);
const rawName = (urlParams.get("player") || "").trim().toLowerCase();

if (!rawName) {
    document.getElementById("playerName").textContent = "Ingen spelare vald";
}


// =======================================
// 3Ô∏è‚É£ Ladda FOTO fr√•n Google Sheet (separat fotoblad)
// =======================================
async function loadPhoto(player) {
    try {
        const res = await fetch(`${API_BASE}?sheet=Spelarfoton`);
        const rows = await res.json();

        const clean = s => String(s).toLowerCase().replace(/\s+/g,"");

        const match = rows.find(r => clean(r.Spelarnamn) === clean(player));

        const id = match ? match.DriveID : "1VAa79pJ-QbyeliY60autf914z6SBwmhp"; // fallback

        const img = document.getElementById("playerPhoto");
        img.src = `https://drive.google.com/thumbnail?id=${id}&sz=w1000`;
        img.onload = () => img.classList.add("loaded");
    }
    catch(err){
        console.error("Foto-fel:", err);
    }
}


// =======================================
// 4Ô∏è‚É£ H√§mta statistik fr√•n API
// =======================================
async function loadStats() {
    const output = document.getElementById("statsOutput");
    const nameEl = document.getElementById("playerName");

    nameEl.textContent = rawName;

    try {
        const res = await fetch(`${API_BASE}?player=${encodeURIComponent(rawName)}`);

        const data = await res.json();
        console.log("DATA:", data);

        if (data.error) {
            output.innerHTML = `
                <div class="no-stats">‚ùå Ingen statistik hittades f√∂r ${rawName}</div>
            `;
            return;
        }

        // Bygg tabell
        let html = `
        <div class="stats-table">
            <table>
                <thead><tr><th>Stat</th><th>V√§rde</th></tr></thead>
                <tbody>
        `;

        for (const key in data) {
            if (key === "sheet") continue;
            html += `
            <tr>
                <td>${key}</td>
                <td>${data[key]}</td>
            </tr>`;
        }

        html += `
                <tr><td>H√§mtad fr√•n</td><td>${data.sheet}</td></tr>
                </tbody></table>
        </div>`;

        output.innerHTML = html;

    } catch(err) {
        output.innerHTML = `<div class="no-stats">‚ö†Ô∏è Fel vid h√§mtning av statistik</div>`;
        console.error(err);
    }
}


// =======================================
// 5Ô∏è‚É£ Starta laddning
// =======================================
loadPhoto(rawName);
loadStats();

</script>

</body>
</html>
