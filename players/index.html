<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Svenska eHockey Cupen ‚Äì Spelarkort</title>

  <style>
/* === GLOBAL S√ñKMODUL (fr√•n lagkortet) === */
.player-search-centered {
  margin: 40px auto 10px auto;
  width: 50%;
  max-width: 550px;
  min-width: 260px;
  border-radius: 22px;
  text-align: center;
  background:
    radial-gradient(circle at top, rgba(255,255,255,0.05) 0, transparent 55%),
    linear-gradient(180deg, #050718, #02030a 70%, #000);
  border: 1px solid rgba(255,255,255,0.08);
  padding: 20px 18px 22px;
}
.search-title {
  font-size: .92rem;
  text-transform: uppercase;
  letter-spacing: .12em;
  font-weight: 600;
  color: var(--sec-text-muted);
  margin-bottom: 6px;
}
.player-search-centered .search-wrapper { position: relative; }
#globalSearch {
  width: 100%;
  padding: 12px 16px;
  border-radius: 14px;
  border: 1px solid rgba(245,216,110,.7);
  background: rgba(2,4,18,0.95);
  color: #fff;
  font-size: .95rem;
}
#globalSearch::placeholder { color: rgba(180,183,216,0.75); }
#globalResults {
  position:absolute;
  top: calc(100% + 6px);
  left: 0;
  width:100%;
  background:#090b17;
  border:1px solid rgba(255,215,0,.25);
  border-radius:14px;
  display:none;
  max-height:260px;
  overflow-y:auto;
  z-index:100;
}
.search-item {
  padding:9px 14px;
  color:#ddd;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.search-item:hover {
  background:rgba(255,215,0,.08);
  color:#f5d86e;
}
.search-pill {
  font-size:.75rem;
  padding:2px 7px;
  border-radius:999px;
  border:1px solid rgba(245,216,110,.7);
  color:#f5d86e;
}
.search-sub {
  font-size:.78rem;
  color:var(--sec-text-muted);
}
Fheade
    
      display: flex;
      align-items: center;
      text-align: center;
      margin: 35px 0 20px;
      color: #f5d86e;
      font-size: 1.3rem;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      text-shadow: 0 0 10px rgba(245,216,110,0.3);
    }

    .section-divider::before,
    .section-divider::after {
      content: "";
      flex: 1;
      border-bottom: 1px solid rgba(245,216,110,0.35);
      margin: 0 14px;
    }

    /* ===============================
       Scroll / premium-tabeller
       =============================== */
    .table-scroll {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-top: 10px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      background:
        radial-gradient(circle at top, rgba(255,255,255,0.04) 0, transparent 55%),
        linear-gradient(180deg, #050716, #02030a 70%, #000);
      box-shadow: 0 18px 55px rgba(0,0,0,0.9);
      scrollbar-width: thin;
      scrollbar-color: #444 #111;
    }

    .table-scroll::-webkit-scrollbar {
      height: 6px;
    }
    .table-scroll::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.7);
    }
    .table-scroll::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 4px;
    }

    .stats-table table {
      width: 100%;
      min-width: 720px;
      border-collapse: collapse;
      font-size: .9rem;
    }

    .stats-table thead {
      background: linear-gradient(90deg, #050c26, #0e1638);
      box-shadow: 0 6px 16px rgba(0,0,0,0.75);
    }

    .stats-table th {
      padding: 10px 9px;
      color: #f5c851;
      text-align: right;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: .06em;
      border-bottom: 1px solid rgba(245,200,81,0.4);
      white-space: nowrap;
    }

    .stats-table th:first-child,
    .stats-table th:nth-child(2) {
      text-align: left;
    }

    .stats-table td {
      padding: 9px 9px;
      border-bottom: 1px solid #151a32;
      text-align: right;
      color: #e2e3f1;
    }

    .stats-table td:first-child,
    .stats-table td:nth-child(2) {
      text-align: left;
    }

    .stats-table tr:nth-child(even) {
      background: rgba(255,255,255,0.01);
    }

    .stats-table tr:hover {
      background: rgba(245,216,110,0.06);
      box-shadow: inset 0 0 0 1px rgba(245,216,110,0.16);
    }

    .table-title {
      margin-top: 28px;
      margin-bottom: 6px;
      text-align: center;
      color: #f5d86e;
      font-size: 1.15rem;
      letter-spacing: .09em;
      text-transform: uppercase;
      text-shadow: 0 0 14px rgba(245,216,110,0.55);
    }

    /* ===============================
       Loader ‚Äì EN gemensam stil
       =============================== */
    .sec-loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 0 4px;
    }

    .loader-text {
      font-size: 0.95rem;
      color: #f6d66b;
      margin-bottom: 8px;
      letter-spacing: .04em;
    }

    .loader-bar {
      width: 200px;
      height: 10px;
      background: rgba(255,255,255,0.08);
      border-radius: 6px;
      border: 1px solid rgba(246,214,107,0.35);
      overflow: hidden;
      margin: 0 auto;
    }

    .loader-bar-fill {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #f6d66b, #ffe7ac);
      animation: secBar 1.8s infinite ease-in-out;
    }

    @keyframes secBar {
      0% { width: 0%; }
      50% { width: 85%; }
      100% { width: 0%; }
    }

    :root {
      --sec-bg-deep: #02030a;
      --sec-bg-top: #080f24;
      --sec-gold: #d6b15f;
      --sec-gold-soft: #f0d58b;
      --sec-text-main: #e3e4f2;
      --sec-text-muted: #b4b7d8;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      background: #000;
      color: var(--sec-text-main);
      min-height: 100vh;
      overflow-x: hidden;
    }

    body {
      display: flex;
      justify-content: center;
    }

    /* Bakgrund */
    #sec-bg-layer {
      position: fixed;
      inset: 0;
      z-index: -2;
      background:
        radial-gradient(circle at 0% 0%, rgba(214,177,95,0.17) 0, transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(88,120,255,0.16) 0, transparent 55%),
        radial-gradient(circle at 50% 100%, #010314 0, #000 70%);
    }

    .smoke-layer {
      position: absolute;
      inset: -20%;
      pointer-events: none;
      background:
        radial-gradient(circle at 20% 20%, rgba(120,140,200,0.12) 0, transparent 45%),
        radial-gradient(circle at 80% 30%, rgba(120,140,200,0.10) 0, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(80,100,160,0.12) 0, transparent 45%);
      opacity: 0;
      animation: smokeFade 1.4s ease forwards .8s, smokeDrift 40s linear infinite;
      mix-blend-mode: screen;
    }

    .smoke-layer.smoke-back {
      filter: blur(22px);
      animation: smokeFade 1.8s ease forwards 1s, smokeDrift 55s linear infinite;
    }

    @keyframes smokeFade { from { opacity:0;} to{opacity:0.4;} }
    @keyframes smokeDrift {
      0% { transform:translate3d(0,0,0) scale(1);}
      50%{ transform:translate3d(-4%,-2%,1px) scale(1.05);}
      100%{transform:translate3d(3%,3%,0) scale(1);}
    }

    #sec-page {
      width: 95%;
      max-width: 1200px;
      padding: 20px 12px 80px 12px;
      animation: pageFade .6s ease-out;
    }

    @keyframes pageFade {
      from { opacity:0; transform: translateY(8px);}
      to { opacity:1; transform: translateY(0);}
    }

    /* TILLBAKA-KNAPP */
    .back-button {
      display: inline-block;
      cursor: pointer;
      color: var(--sec-gold-soft);
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 12px;
      padding: 8px 14px;
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(214,177,95,0.35);
      box-shadow: 0 0 18px rgba(214,177,95,0.15);
      transition: 0.2s;
      width: fit-content;
    }

    .back-button:hover {
      background: rgba(255,215,0,0.15);
      color: #fff;
      transform: translateX(-3px);
    }

    /* Header */
    .sfc-header {
      margin-top: 12px;
      border-radius: 22px;
      padding: 26px 16px 22px;
      background:
        linear-gradient(145deg, rgba(255,255,255,0.05), transparent 40%),
        radial-gradient(circle at top, #151b3f 0, #050614 55%, #02030a 100%);
      border: 1px solid rgba(214,177,95,0.6);
      box-shadow: 0 20px 60px rgba(0,0,0,0.95);
      text-align: center;
    }

    .sfc-logo {
      width: 165px;
      filter: drop-shadow(0 0 20px rgba(214,177,95,0.7));
    }

    .sfc-title {
      font-weight: 800;
      font-size: clamp(1.3rem, 2.6vw, 1.7rem);
      letter-spacing: .18em;
      text-transform: uppercase;
      margin-top: 6px;
    }

    .sfc-title strong {
      color: var(--sec-gold-soft);
    }

    .sfc-divider {
      width: 180px;
      height: 3px;
      margin: 18px auto 0;
      border-radius: 999px;
      background: linear-gradient(90deg,transparent,var(--sec-gold-soft),transparent);
      box-shadow: 0 0 15px rgba(214,177,95,0.8);
    }

    .player-shell {
      margin-top: 32px;
      width: 95%;
      max-width: 1100px;
      margin-inline: auto;
    }

    /* Spelarkort */
    .player-card {
      width: 100%;
      border-radius: 22px;
      background:
        radial-gradient(circle at top, rgba(255,255,255,0.04), transparent 55%),
        linear-gradient(180deg, #060715, #02030a 60%, #000);
      border:1px solid rgba(255,255,255,0.06);
      padding:24px 20px;
      text-align:center;
    }

    #playerPhoto {
      width: 260px;
      max-width: 95%;
      border-radius:20px;
      padding:6px;
      background:#050712;
      border:2px solid rgba(255,215,0,.35);
      margin-bottom:12px;
      object-fit: cover;
    }

    #playerName {
      font-size:1.6rem;
      font-weight:700;
      color:#f5d86e;
      letter-spacing:.06em;
      text-transform:uppercase;
      margin-bottom:6px;
    }

    .player-subtitle {
      font-size:.88rem;
      color:var(--sec-text-muted);
      margin-bottom:12px;
      text-transform:uppercase;
      letter-spacing:.08em;
    }

    .no-stats {
      margin-top:10px;
      background:#3a0000;
      border:1px solid #ff4d4d;
      padding:10px;
      border-radius:10px;
      text-align:center;
      font-size:0.9rem;
    }

    /* S√∂kmodul */
    .player-search-centered {
      margin: 40px auto 10px auto;
      width: 50%;
      max-width: 550px;
      min-width: 260px;
      border-radius: 22px;
      text-align: center;
      background:
        radial-gradient(circle at top, rgba(255,255,255,0.05) 0, transparent 55%),
        linear-gradient(180deg, #050718, #02030a 70%, #000);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 20px 18px 22px;
    }

    .search-title {
      font-size: .92rem;
      text-transform: uppercase;
      letter-spacing: .12em;
      font-weight: 600;
      color: var(--sec-text-muted);
      margin-bottom: 6px;
    }

    .player-search-centered .search-wrapper {
      position: relative;
    }

    #playerSearch {
      width: 100%;
      padding: 12px 16px;
      border-radius: 14px;
      border: 1px solid rgba(245,216,110,.7);
      background: rgba(2,4,18,0.95);
      color: #fff;
      font-size: .95rem;
    }

    #playerSearch::placeholder {
      color: rgba(180,183,216,0.75);
    }

    #searchResults {
      position:absolute;
      top: calc(100% + 6px);
      left: 0;
      width:100%;
      background:#090b17;
      border:1px solid rgba(255,215,0,.25);
      border-radius:14px;
      display:none;
      max-height:230px;
      overflow-y:auto;
      z-index:100;
    }

    .search-item {
      padding:9px 14px;
      color:#ddd;
      cursor:pointer;
    }

    .search-item:hover {
      background:rgba(255,215,0,.08);
      color:#f5d86e;
    }

    /* Meriter */
    .merit-title {
      margin-top: 25px;
      margin-bottom: 6px;
      text-align: center;
      color: #f5d86e;
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      text-shadow: 0 0 14px rgba(245,216,110,0.55);
    }

    .merit-list {
      text-align: center;
      margin-top: 4px;
      font-size: 1rem;
      line-height: 1.7;
      color: #e3e4f2;
    }

    /* Footer */
    #sec-footer-wrapper {
      margin-top: 30px;
      padding-top: 18px;
      border-top: 1px solid rgba(214,177,95,0.35);
      text-align: center;
      font-size: 0.8rem;
      color: var(--sec-text-muted);
    }

    #sec-footer-wrapper span {
      color: var(--sec-gold-soft);
      font-weight: 600;
    }

    @media (max-width: 600px) {
      .player-search-centered {
        width: 90%;
      }

      #playerPhoto {
        width: 220px;
      }
    }
  </style>
</head>

<body>
  <!-- Bakgrund -->
  <div id="sec-bg-layer">
    <div class="smoke-layer smoke-back"></div>
    <div class="smoke-layer"></div>
  </div>

  <div id="sec-page">

    <!-- üîô TILLBAKA-KNAPP -->
    <div class="back-button" onclick="history.back()">
      ‚Üê Tillbaka
    </div>

    <!-- HEADER -->
    <a href="https://sweehockey-svg.github.io/SEC/index.html" style="text-decoration:none; color:inherit;">
      <div class="sfc-header">
        <img class="sfc-logo" src="https://drive.google.com/thumbnail?id=1QybW_Uw8HO0OXo8vwQFD-zrrr-ifFrC9&sz=w1000" alt="SEC Logo">
        <div class="sfc-title">
          üèÜ Svenska eHockey <strong>Cupen</strong> üèí
        </div>
        <div class="sfc-divider"></div>
      </div>
    </a>

    <div class="player-shell">
      <!-- SPELARKORT -->
      <div class="player-card">
        <!-- DEFAULT + FALLBACK-BILD -->
        <img
          id="playerPhoto"
          alt="Spelarbild"
          src="https://drive.google.com/thumbnail?id=1VAa79pJ-QbyeliY60autf914z6SBwmhp&sz=w1000"
          onerror="this.onerror=null;this.src='https://drive.google.com/thumbnail?id=1VAa79pJ-QbyeliY60autf914z6SBwmhp&sz=w1000';"
        >
        <div id="playerName">Ingen spelare vald</div>

        <!-- üîπ EN GEMENSAM LOADER F√ñR STATISTIK -->
        <div id="statsLoader" class="sec-loader" style="display:none; margin: 18px auto 6px;">
          <div class="loader-text">Statistik laddas‚Ä¶</div>
          <div class="loader-bar">
            <div class="loader-bar-fill"></div>
          </div>
        </div>

        <div id="statsOutput"></div>
      </div>

<!-- üîé GLOBAL S√ñK ‚Äì LAG + SPELARE -->
<div class="player-search-centered">
  <div class="search-title">S√∂k i SEC</div>
  <div class="search-wrapper">
    <input id="globalSearch" placeholder="S√∂k lag eller spelare...">
    <div id="globalResults"></div>
  </div>
</div>


    <!-- FOOTER -->
    <div id="sec-footer-wrapper">
      ¬© 2025 <span>Svenska eHockey Cupen</span> | Design & utveckling av <span>SWEEHOCKEY</span>
    </div>

  </div>

  <script>
  const API = "https://script.google.com/macros/s/AKfycbwUvylvIbUTy4_zihW5_OKIsQME2vxcPHWLldObZI28dggqJytvF2UmdsAD4Ib5Zre1/exec";

  /* full team-map */
  const TEAM_MAP = {
    "3TU":"3Tuna Le sport","AL":"A Laget","AFT":"AFTERLIFE","AIS":"Almtuna ESPORT","AVE":"Avenyn Esport","BAC":"BACKCHECK BOYS","BAS":"Bask Nation","BEE":"Beerhouse","BGS":"Biggie Stockholm","BIK":"BIK Karlskoga Esport","BV":"Birka Vikings","IFB":"Bj√∂rkl√∂ven Esport","CLS":"Black Clovers","BES":"Black Eagles Sweden","Bla":"Black Panthers","BPS":"Black Phantoms","BD":"Blackdawgs","BSU":"Blessed Suedis","BOI":"BOIS IK","Bom":"Bombers Hockey","Boo":"Boost HC","BOR":"BortaMatch HC","BRA":"Brain Freezers","BB":"Brunker Bulldogs","BIF":"Bryn√§s IF Esport","Bul":"Bull sharks","CAL":"Calippo HC","ICE":"Carolus Icemen","CAV":"Cavemen Hockey","CHA":"Charleswood Chiefs","CHC":"Chiefzz HC","CLO":"Clowns","COG":"Company of Geeks","CRA":"Crash The Net HC","Dar":"Dark City Knights","DIC":"DICE Hockey","DTS":"Dirty Tacklers HC","DIF":"Djurg√•rden","DOM":"Dompa HC","DRA":"Dracones","DHY":"Dynamic Hockey","LXN":"E∆é Lag AntonLxnd","LGB":"E∆é Lag bystrom___","TCO":"E∆é Lag el_tacobag","LHZ":"E∆é Lag GD_Hampezz","FRY":"E∆é Lag l-Furyan-l","SLO":"E∆é Lag Sloogan9498","STG":"E∆é Lag Sneipthegunner","T50":"E∆é Lag Toivo4936","WAG":"E∆é Lag Wagge01","La":"E∆é Lag xAlknas","AC":"E∆é Lag xCurhed","Boe":"E∆é Lag xSnorlaaxx","EC":"Enkoping City","ENK":"Enk√∂ping Hks","EE":"Etuna Eagles","EVO":"Evolution HC","KBK":"F√§rjestad","FBK":"F√§rjestad BK","Far":"Farmalaget","FEM":"Favoritfemman","FEN":"Fenris Wolves","FIL":"Fila De La Hc","FF":"Fl√§die Faxes","FFR":"Free From Rodents","FHC":"Fr√∂lunda HC Academy","FR":"Fr√∂lunda HC Region","FSE":"Full send esport","GVL":"Gefle Bocken","GH":"Get Hagens HC","GIF":"Gifflarna HC","GB":"Glacies Bellator","GLA":"Glasbanken se","GHK":"Gleumes Hockey Krefeld","GD":"Green Devils","GHC":"Guldkallan HC","HAM":"Hamra Allstars","PE":"HC Pustertal Esports","HCZ":"HCZ","INC":"Hockey INC","HOC":"Hockey of the north","HP":"HockeyProfessorn HC","HRR":"Hokurit","HAW":"Hundred Acre Woods","HV":"HV71","Nld":"IFK Norrland","IKY":"IK EyBro","IKP":"Ik Pantern Esport","ISU":"Ik Stolpe ut","Ill":"Illumination","Ilu":"Illusion","JHC":"Jokers Hockey","KAJ":"KAJAK Esports","KAL":"KALMARUNIONEN","KNG":"Kingping","KXS":"Knox Stark","KP":"Kompaniet","KRK":"Kraken","OK":"Kronofogden Esport","KUM":"Kumla hockey","LOE":"Lack of Empathy","BYS":"Lag bystrom","AKE":"Lag Aker36","AND":"Lag andreaskakan","ANT":"Lag antoniomannen","AXE":"Lag Axelzonee","BEN":"Lag benjamint","BRU":"Lag Bruno_32","DAS":"Lag Dasplund","DII":"Lag Diizzylicious","ECK":"Lag eckeson","ELI":"Lag eliekamel_","EPS":"Lag ePsych0-","HEN":"Lag Henning92","LGH":"Lag Hojerslev","JAR":"Lag Jarvinder","JEP":"Lag Jepplo02","JON":"Lag Jonass1551","LAR":"Lag Larsson_500","LL":"Lag LaxenHD","LOK":"Lag Lokope11","LGL":"Lag LordOlii","MAT":"Lag Mathiasgamer_07","MES":"Lag mesimaki94","PRA":"Lag Prallelkova","LR":"Lag RookieLIAMOV","SNU":"Lag Snus","STE":"Lag Stenborg431","STI":"Lag stickovic","LGS":"Lag Svamp GG","TAB":"Lag Tablehockey","TAN":"Lag TantBerit","V1C":"Lag v1CTANK","LAL":"Lallare HC","LAM":"LAMPA","Las":"Las Palmas HC","CCN":"Le Club Chat Noir","LEG":"LEGION HC","LIF":"Leksand","LH":"Link√∂ping","LHC":"Lofoten HC","666":"Lucid Dreams","LLE":"Ludvika Lightning Esport","LHK":"Lule√•","LHF":"Lule√• Hockey Region","LUM":"Lumberjacks HC","MAC":"Macho","MAD":"MAD Knogmackers HC","MIF":"Malm√∂","FOG":"MG≈ÅA","MF":"Miami Freeze","Mel":"Mighty Mel HC","XXX":"Mighty Stixxx","MOD":"Modo Hockey","MIK":"Mora IK","MHC":"Morganchipsen HC","NWG":"No Worries Guys","NF":"Nordic Falcons","NK":"Nordic Knights","NKH":"Nordic Knights HC","NL":"Nordic Lightning","NOS":"Nordic Nosebleed","NOR":"Nordic Vipers","NVB":"Norra V√§sterbotten","NOF":"Norska f√∂rbundslaget","NHC":"North Hockey Academy","ND":"Northern Dust","NH":"Northern Heroes","Ock":"Ockelbo Ehockey","Olj":"Oljefondet","OME":"Omerta","omb":"Omerta beyond","ONT":"On The Road Again","One":"One HC","OBK":"√ñrebro","ODH":"Orebro deaf hockeY","OHA":"Orebro Hockey Academy","IKO":"Oskarshamn","OIK":"Oskarshamn IK","PAT":"Patriots","PHO":"Phoenix","POL":"Polarbears HC","PRO":"Prowlers Esport","PUR":"Purification","PC":"Purple Cobraas","RAE":"Rains It Poors","RHC":"Rava HC","RCT":"RCTIC","RNS":"Redemption Stars","ROP":"Rimon o Pumba","RGT":"Ringette HC","RBK":"R√∂gle","ROR":"Rorvik HC","RHT":"Royal HT","RPT":"RPEAT ESPORTS","SAN":"SandhedYoungGuns","SoS":"SCRUBS","SPT":"Serpentes","SHS":"Shifty Shafts","SHW":"Showtimes","112":"Sjukstugan","SAI":"Skellefte√•","Sku":"Skumtomtarnas arme","SW":"SPARTA WARRIORS1928","SPA":"Spartans eSport","SA":"SSK Academy","SSA":"SSK Adepts","SSK":"SSK eSport","SI":"SSK Ignite","SSP":"SSK Prospects","SBH":"Stallarholmens Brygghus","STR":"Starz HC","SAS":"Stayhard Stallions","BKN":"Stockholm Black Knights","SIL":"Storhamar IL Esport","SuS":"SUKAT JA SANDAALIT","SES":"Sunne IK Esport","SS":"Surte Sisu HC","SYN":"Synergy Hockey","TMO":"Team Modo","TR":"Team Rocket","TBT":"THE BLUE TELGE","TRB":"The red bullets","TRW":"THE RELENTLESS WOLFS HC","SOL":"The Solution","WoW":"The Worn Out Wisemen","TB":"Thigh Bay","TES":"TIGERS E-sport","TIK":"Timr√• IK","TRA":"Trasdockorna","TRE":"Troillan Esport","TRO":"Trojans","TUN":"Tundra","ULV":"Ulvhednar HC","UR":"UnderRated","UNI":"UNI Gaming","UN":"Unknown Heroes","UNW":"Unwanted","VAH":"Valbo hockey","VIK":"V√§ster√•s IK","VAX":"V√§xjo","VBS":"VBO B Stars","VBO":"VBO Stars","VER":"Verket","hmm":"Veterankraft","Vic":"Viccingi","VIP":"Viper hc","NEX":"vNexs Faxes","vNV":"vNexs Vipers","vNW":"VNexs wisemen","VS":"Vtuna Socken","WHI":"WHITE WINGS","WS":"Whitesharks","WIL":"Wild rockets Hc","WIS":"Wisby Islanders","You":"Young Guys"
  };

  function teamName(code) {
    return TEAM_MAP[code] || code;
  }

  /* URL-PLAYER */
  const params = new URLSearchParams(location.search);
  const player = params.get("player") || "";
  document.getElementById("playerName").textContent = player || "Ingen spelare vald";

  /* Normalisera text */
  function norm(s) {
    return String(s || "")
      .toLowerCase()
      .replace(/[,]/g, "")
      .replace(/\s+/g, "")
      .replace(/[^a-z0-9]/g, "");
  }

  function cleanSheetName(name) {
    return String(name || "").split(",")[0].trim();
  }

  /* ALL PLAYERS ‚Äì utan egen loader (g√•r i bakgrunden) */
  let allPlayers = [];

  async function loadAllPlayersFast() {
  try {
    const uteRes = await fetch(API + "?sheet=utestatsall");
    const mvRes  = await fetch(API + "?sheet=m√•lvaktsstatsall"); // FIX!

    const uteData = await uteRes.json();
    const mvData  = await mvRes.json();

    const names = [];
    const seen = new Set();

    function addNamesFromMatrix(matrix, headerName) {
      if (!Array.isArray(matrix) || matrix.length < 2) return;
      const header = matrix[0];
      const idx = header.indexOf(headerName);
      if (idx === -1) return;

      for (let i = 1; i < matrix.length; i++) {
        const row = matrix[i];
        const name = row[idx];
        if (!name) continue;
        const key = norm(name);
        if (!key || seen.has(key)) continue;
        seen.add(key);
        names.push({ PLAYER: cleanSheetName(name), RAW: name });
      }
    }

    addNamesFromMatrix(uteData, "PLAYERS");
    addNamesFromMatrix(mvData, "GOALIES");

    allPlayers = names;

  } catch (err) {
    console.error("Fel vid laddning av allplayers:", err);
  }
}


/* === GLOBAL S√ñK ‚Äî spelare + lag === */

/* Normaliserad text */
function normSearch(str) {
  return String(str || "")
    .toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replace(/\s+/g, "")
    .replace(/[^a-z0-9]/g, "");
}

function extractCupNumberForSearch(cupValue) {
  if (!cupValue) return "";
  return String(cupValue).replace("SEC", "").trim().split(" ")[0];
}

/* Team-map (kort version ‚Äì du har full version ovan) */
const TEAM_MAP_SEARCH = TEAM_MAP; // √•teranv√§nd stor map

async function initGlobalSearch() {
  const inp = document.getElementById("globalSearch");
  const box = document.getElementById("globalResults");
  if (!inp || !box) return;

  let items = [];
  const seenPlayers = new Set();
  const teamCups = {};

  try {
    const [uteRes, mvRes] = await Promise.all([
      fetch(API + "?sheet=utestatsall").then(r => r.json()),
      fetch(API + "?sheet=m√•lvaktsstatsall").then(r => r.json())
    ]);

    /* ---- Utespelare ---- */
    (function () {
      const h = uteRes[0];
      const iPlayer = h.indexOf("PLAYERS");
      const iTeam   = h.indexOf("TEAM");
      const iCup    = h.indexOf("CUP");

      for (let i = 1; i < uteRes.length; i++) {
        const r = uteRes[i];
        if (!r) continue;

        const raw = r[iPlayer];
        if (!raw) continue;

        const name = raw.replace(/,\s*[A-Z]{2,3}$/i, "").trim();
        const team = TEAM_MAP_SEARCH[r[iTeam]] || r[iTeam];
        const cup  = extractCupNumberForSearch(r[iCup]);

        if (!teamCups[team]) teamCups[team] = new Set();
        teamCups[team].add(cup);

        const key = normSearch(name);
        if (!seenPlayers.has(key)) {
          seenPlayers.add(key);
          items.push({ type: "player", label: name, player: name });
        }
      }
    })();

    /* ---- M√•lvakter ---- */
    (function () {
      const h = mvRes[0];
      const iGoalie = h.indexOf("GOALIES");
      const iTeam   = h.indexOf("TEAM");
      const iCup    = h.indexOf("CUP");

      for (let i = 1; i < mvRes.length; i++) {
        const r = mvRes[i];
        if (!r) continue;

        const raw = r[iGoalie];
        if (!raw) continue;

        const name = raw.replace(/,\s*[A-Z]{2,3}$/i, "").trim();
        const team = TEAM_MAP_SEARCH[r[iTeam]] || r[iTeam];
        const cup  = extractCupNumberForSearch(r[iCup]);

        if (!teamCups[team]) teamCups[team] = new Set();
        teamCups[team].add(cup);

        const key = normSearch(name);
        if (!seenPlayers.has(key)) {
          seenPlayers.add(key);
          items.push({ type: "player", label: name, player: name });
        }
      }
    })();

    /* ---- Lag (per cup) ---- */
    for (const teamName of Object.keys(teamCups)) {
      for (const cup of teamCups[teamName]) {
        if (!cup) continue;
items.push({
  type: "team",
  label: teamName,
  sub: `SEC ${cup}`,
  team: teamName,   // ‚Üê SKICKA NAMNET, inte r[iTeam]
  cup: cup
});

      }
    }

  } catch (e) {
    console.error("Global search-fel:", e);
  }

  /* üîÑ Render */
  function render(list) {
    if (!list.length) {
      box.style.display = "none";
      return;
    }
    box.style.display = "block";
    box.innerHTML = list.map(it => `
      <div class="search-item"
           data-type="${it.type}"
           data-player="${it.player || ""}"
           data-team="${it.team || ""}"
           data-cup="${it.cup || ""}">
        <div>
          ${
            it.type === "team"
              ? `${it.label} ‚Äì <span class="search-sub">${it.sub}</span>`
              : it.label
          }
        </div>
        <div class="search-pill">${it.type === "team" ? "Lag" : "Spelare"}</div>
      </div>
    `).join("");

    /* Klick event */
box.querySelectorAll(".search-item").forEach(el => {
  el.onclick = () => {

    if (el.dataset.type === "team") {
      // LAGKORT ligger i /SEC/lagkort
      location.href = `/SEC/lagkort.html?team=${encodeURIComponent(el.dataset.team)}&cup=${encodeURIComponent(el.dataset.cup)}`;
      return;
    }

    // SPELARKORT ligger i /SEC/players/
    location.href = `/SEC/players/?player=${encodeURIComponent(el.dataset.player)}`;
  };
});
  }

  /* Input-event */
  inp.addEventListener("input", () => {
    const q = normSearch(inp.value.trim());
    if (!q) return render([]);

    const result = items
      .filter(it => normSearch(it.label).includes(q))
      .slice(0, 40);

    render(result);
  });

  /* Klick utanf√∂r = st√§ng listan */
  document.addEventListener("click", e => {
    if (!box.contains(e.target) && e.target !== inp) {
      box.style.display = "none";
    }
  });
}

/* Starta s√∂ket */
document.addEventListener("DOMContentLoaded", initGlobalSearch);


  /* Format GAA */
  function formatGAA(raw) {
    if (raw == null || raw === "") return "";
    if (typeof raw === "string" && raw.includes("T")) {
      const d = new Date(raw);
      if (!isNaN(d)) {
        const h = d.getUTCHours();
        const m = d.getUTCMinutes();
        const val = h + m / 60;
        return val.toFixed(2);
      }
    }
    const num = Number(raw);
    if (!isNaN(num)) return num.toFixed(2);
    return raw;
  }

  /* Format SV% (f√∂r visning) */
  function formatSVP(value) {
    if (!value && value !== 0) return "0%";
    let v = value.toString().replace(",", ".");
    let num = parseFloat(v);
    if (isNaN(num)) return "0%";
    if (num > 0 && num < 1) {
      return (num * 100).toFixed(1) + "%";
    }
    if (num >= 1 && num <= 100) {
      return num.toFixed(1) + "%";
    }
    if (num > 100) {
      return (num / 100).toFixed(2) + "%";
    }
    return num.toFixed(1) + "%";
  }

  // üîß F√∂r att j√§mf√∂ra SV% korrekt (".879", "87.9", "87.9%")
  function parseSVP(raw) {
    if (!raw) return 0;

    let v = String(raw).replace(",", ".").trim();

    if (v.endsWith("%")) {
      v = v.replace("%", "");
      let num = parseFloat(v);
      return isNaN(num) ? 0 : num / 100;
    }

    let num = parseFloat(v);
    if (num > 1) return num / 100;
    return isNaN(num) ? 0 : num;
  }

  /* Nationaliteter */
  function translateNationality(code) {
    if (!code) return "";
    const map = {
      "SWE": "Svensk",
      "FIN": "Finsk",
      "NOR": "Norsk",
      "DEN": "Dansk",
      "DK":  "Dansk",
      "GER": "Tysk",
      "DE":  "Tysk",
      "FRA": "Fransk",
      "CZE": "Tjeckisk",
      "SVK": "Slovakisk",
      "SUI": "Schweizisk",
      "CHE": "Schweizisk",
      "AUT": "√ñsterrikisk",
      "LAT": "Lettisk",
      "EST": "Estnisk",
      "LTU": "Litauisk",
      "POL": "Polsk",
      "NLD": "Nederl√§ndsk",
      "NED": "Nederl√§ndsk",
      "GBR": "Brittisk",
      "ENG": "Engelsk"
    };
    code = code.trim().toUpperCase();
    return map[code] || code;
  }

  /* API-bundle */
  async function fetchBundle(playerName) {
    const url = API + "?player=" + encodeURIComponent(playerName);
    const res = await fetch(url);
    return await res.json();
  }

  // Hj√§lpfunktion: dela upp "SEC 17 G" ‚Üí { num: "17", group: "G" }
  function splitTurneringLabel(turn) {
    if (!turn) return { num: "?", group: "" };
    let c = String(turn).replace(/SEC/gi, "").trim(); // t.ex. "17 G" eller "19.5 S"
    const parts = c.split(/\s+/);
    return {
      num: parts[0] || "?",
      group: parts[1] || ""
    };
  }

  /* LOAD STATS */
  async function loadStats() {
    const out = document.getElementById("statsOutput");
    const loaderStats = document.getElementById("statsLoader");

    if (!player) {
      out.innerHTML = `<div class="no-stats">Ingen spelare vald.</div>`;
      out.style.display = "block";
      return;
    }

    loaderStats.style.display = "flex";
    out.style.display = "none";

    try {
      const bundle = await fetchBundle(player);

      if (!bundle || bundle.error || !Array.isArray(bundle.stats) || !bundle.stats.length) {
      ggen statistik hittades.</div>`;
        out.style.display = "block";
        loaderStats.style.display = "none";
        return;
      }

      const originalData = bundle.stats || [];
      const winners = Array.isArray(bundle.winners) ? bundle.winners : [];
      const defaultPhotoId = "1VAa79pJ-QbyeliY60autf914z6SBwmhp";
      const photoId = bundle.photoId || defaultPhotoId;

      /* FOTO */
      const img = document.getElementById("playerPhoto");
      img.src = `https://drive.google.com/thumbnail?id=${photoId}&sz=w1000`;
      img.loading = "eager";

      /* Utespelare / m√•lvakt */
      const skaters = originalData.filter(r => r.PLAYERS);
      const goalies = originalData.filter(r => r.GOALIES);

      skaters.forEach(r => { r.TURNERING = r.CUP; });
      goalies.forEach(r => { r.TURNERING = r.CUP; });

      const allRows = [...skaters, ...goalies];

      /* Namn + nationalitet */
      let rawName =
        (skaters[0] && skaters[0].PLAYERS) ||
        (goalies[0] && goalies[0].GOALIES) ||
        player;

      rawName = String(rawName);
      const nameParts = rawName.split(",");
      let cleanName = nameParts[0].trim();
      let natCode   = (nameParts[1] || "").trim();
      let nationality = translateNationality(natCode);

      document.getElementById("playerName").textContent = cleanName;

     /* Cup-lista f√∂r bio (utan fas-bokstav) */
function parseCupNumber(turnString) {
  if (!turnString) return "";
  const clean = String(turnString)
    .replace("SEC", "")
    .trim()
    .toUpperCase();

  const parts = clean.split(/\s+/);
  return parts[0] || "";
}

// Samla alla turneringar (helt kraschs√§kert)
const cupNumberSet = new Set();

allRows.forEach(r => {
  if (!r || !r.TURNERING) return;   // <-- Viktigt!
  const num = parseCupNumber(r.TURNERING);
  if (num) cupNumberSet.add(num);
});

const cupNumbers = [...cupNumberSet].sort((a, b) => parseFloat(a) - parseFloat(b));

// firstCup / lastCup
const firstCup = cupNumbers.length ? "SEC " + cupNumbers[0] : "SEC ?";
const lastCup  = cupNumbers.length ? "SEC " + cupNumbers[cupNumbers.length - 1] : "SEC ?";

// firstRow / lastRow (fels√§krat)
const firstRow = allRows.find(r => r.TURNERING && parseCupNumber(r.TURNERING) === cupNumbers[0]);
const lastRow  = allRows.find(r => r.TURNERING && parseCupNumber(r.TURNERING) === cupNumbers[cupNumbers.length - 1]);

const firstTeam = firstRow ? teamName(firstRow.TEAM) : "-";
const lastTeam  = lastRow ? teamName(lastRow.TEAM) : "-";

const totalGames = allRows.reduce((n, r) => n + Number(r.GP || 0), 0);


      /* B√§sta cup */
      const bestSkater = skaters.length
        ? skaters.reduce((b, r) => (!b || Number(r.PTS || 0) > Number(b.PTS || 0) ? r : b), null)
        : null;




      // üî• Hitta b√§sta m√•lvakten baserat p√• korrekt SV%
      const bestGoalie = goalies.length
        ? goalies.reduce((best, row) => {
            const rSV = parseSVP(row.SVP);
            const bSV = best ? parseSVP(best.SVP) : -1;
            return rSV > bSV ? row : best;
          }, null)
        : null;

      let bestCupText = "";

      // ‚úèÔ∏è Ny text f√∂r b√§sta utespelar-cup i "personlig merit"-stil
      if (bestSkater) {
        const sParts = splitTurneringLabel(bestSkater.TURNERING);
        const skaterCupLabel = `SEC ${sParts.num}${sParts.group ? " " + sParts.group : ""}`;

        bestCupText += `
          <div style="margin-top:10px;">
            üèí Hans b√§sta turnering som utespelare kom i <strong>${skaterCupLabel}</strong>, 
            d√§r han gjorde <strong>${bestSkater.PTS}</strong> po√§ng f√∂r 
            <strong>${teamName(bestSkater.TEAM)}</strong>.
          </div>
        `;
      }

      // ‚úèÔ∏è Ny text f√∂r b√§sta m√•lvakts-cup i √∂nskad stil
      if (bestGoalie) {
        const gParts = splitTurneringLabel(bestGoalie.TURNERING);
        const goalieCupLabel = `SEC ${gParts.num}${gParts.group ? " " + gParts.group : ""}`;

        bestCupText += `
          <div style="margin-top:10px;">
            üß± Hans b√§sta turnering som m√•lvakt kom i <strong>${goalieCupLabel}</strong>, 
            d√§r han noterades f√∂r en r√§ddningsprocent p√• 
            <strong>${formatSVP(bestGoalie.SVP)}</strong> med 
            <strong>${teamName(bestGoalie.TEAM)}</strong>.
          </div>
        `;
      }

      /* ===============================
   üèÜ Meriter + Po√§ngliga + Skytteligan
   =============================== */
let meritBlockGoldSilver = "";
let meritBlockPersonal   = "";

/* ---- üèÜ Guld & silver ---- */
winners.forEach(w => {
  const num = String(w.cup || "")
    .replace(/SEC/gi,"")
    .replace(/[^\d.]/g,"")
    .trim();
  if (!num) return;

  const row = allRows.find(r => {
    const turn = String(r.TURNERING || "")
      .replace(/SEC/gi,"")
      .replace(/[^\d.]/g,"")
      .trim();
    return turn === num;
  });
  if (!row) return;

  const tm = teamName(row.TEAM).toLowerCase();

  if (tm === String(w["1a"] || "").toLowerCase()) {
    meritBlockGoldSilver += `üèÜ <strong>M√§stare i SEC ${num}</strong> med <strong>${teamName(w["1a"])}</strong>.<br>`;
  }
  if (tm === String(w["2a"] || "").toLowerCase()) {
    meritBlockGoldSilver += `ü•à <strong>2:a i SEC ${num}</strong> med <strong>${teamName(w["2a"])}</strong>.<br>`;
  }
});


      /* ---- üìä Po√§ngliga + Skytteligan + M√•lvakter TOPP 3 ---- */
      const pointData = await fetch(API + "?sheet=utestatsall").then(r => r.json());

      if (Array.isArray(pointData) && pointData.length > 1) {

        const header = pointData[0];
        const iCup   = header.indexOf("CUP");
        const iName  = header.indexOf("PLAYERS");
        const iG     = header.indexOf("G");
        const iPTS   = header.indexOf("PTS");
        const iTeam  = header.indexOf("TEAM");
        const iGPsk  = header.indexOf("GP");   // lagets matcher i cupen (utespelare-GP)

        const perCup    = {};
        const teamGames = {}; // key: "SEC 12 G|SHW" ‚Üí antal spelade matcher

        for (let i = 1; i < pointData.length; i++) {
          const r = pointData[i];
          const rawCup = r[iCup];
          const team   = r[iTeam];

          if (!rawCup || !team) continue;

          const cupKey  = String(rawCup).trim();      // t.ex. "SEC 12 G"
          const teamKey = String(team).trim();        // t.ex. "SHW"
          const mapKey  = `${cupKey}|${teamKey}`;
          const gpSk    = Number(r[iGPsk] || 0);

          // Spara lagets matcher i cupen (max-v√§rdet r√§cker)
          if (!teamGames[mapKey] || gpSk > teamGames[mapKey]) {
            teamGames[mapKey] = gpSk;
          }

          // Samla spelare per cup f√∂r po√§ng-/skytteliga
          if (!perCup[cupKey]) perCup[cupKey] = [];
          perCup[cupKey].push({
            player: r[iName],
            pts: Number(r[iPTS] || 0),
            g:   Number(r[iG]   || 0)
          });
        }

        const pointRows = [];
        const goalRows  = [];

        Object.keys(perCup).forEach(cupKey => {
          const list = perCup[cupKey].sort((a, b) =>
            b.pts - a.pts || b.g - a.g
          );

          const cupLabel = cupKey.replace(/SEC/gi, "").trim();

          const one   = list[0];
          const two   = list[1];
          const three = list[2];

          // üìä Po√§ngligan
          if (one && norm(cleanSheetName(one.player)) === norm(cleanName))
            pointRows.push({ rank: 1, cup: cupLabel, pts: one.pts, g: one.g });

          if (two && norm(cleanSheetName(two.player)) === norm(cleanName))
            pointRows.push({ rank: 2, cup: cupLabel, pts: two.pts, g: two.g });

          if (three && norm(cleanSheetName(three.player)) === norm(cleanName))
            pointRows.push({ rank: 3, cup: cupLabel, pts: three.pts, g: three.g });

          // üèπ Skytteligan
          const goalSorted = [...perCup[cupKey]].sort((a, b) =>
            b.g - a.g || b.pts - a.pts
          );

          const g1 = goalSorted[0];
          const g2 = goalSorted[1];
          const g3 = goalSorted[2];

          if (g1 && norm(cleanSheetName(g1.player)) === norm(cleanName))
            goalRows.push({ rank: 1, cup: cupLabel, g: g1.g });

          if (g2 && norm(cleanSheetName(g2.player)) === norm(cleanName))
            goalRows.push({ rank: 2, cup: cupLabel, g: g2.g });

          if (g3 && norm(cleanSheetName(g3.player)) === norm(cleanName))
            goalRows.push({ rank: 3, cup: cupLabel, g: g3.g });
        });


/* ============================
   üß± OPTIMERAD M√ÖLVAKTS-DEL (GP ‚â• 3 & 40% av lagets matcher)
   ============================ */

function parseSVPclean(v) {
  if (!v) return 0;
  let x = String(v).replace(",", ".").replace("%", "");
  let num = parseFloat(x);
  if (num > 1) return num / 100;
  return isNaN(num) ? 0 : num;
}

function parseCupNumber(turn) {
  if (!turn) return "";
  const clean = String(turn).replace("SEC", "").trim();
  return clean.split(/\s+/)[0] || "";
}

function parseCupGroup(turn) {
  if (!turn) return "";
  const clean = String(turn).replace("SEC", "").trim();
  return (clean.split(/\s+/)[1] || "").toUpperCase();
}

let goalieSVBlock = "";

// 1) H√§mta hela m√•lvaktsmatrisen
const goalieMatrix = await fetch(API + "?sheet=m√•lvaktsstatsall").then(r => r.json());

if (Array.isArray(goalieMatrix) && goalieMatrix.length > 1) {

  const gHeader = goalieMatrix[0];
  const giName  = gHeader.indexOf("GOALIES");
  const giTeam  = gHeader.indexOf("TEAM");
  const giSVP   = gHeader.indexOf("SVP");
  const giCup   = gHeader.indexOf("CUP");
  const giGP    = gHeader.indexOf("GP");

  const perCupGroup = {};
  const teamGames = {}; // cup|grp|TEAM ‚Üí lagets GP (max v√§rde)

  // 2) Bygg dataset + lagens matchantal
  for (let i = 1; i < goalieMatrix.length; i++) {
    const row = goalieMatrix[i];
    const gName = row[giName];
    const gTeam = row[giTeam];
    const gSVP  = row[giSVP];
    const gCup  = row[giCup];
    const gGP   = Number(row[giGP] || 0);

    if (!gName || !gCup) continue;

    const num = parseCupNumber(gCup);
    const grp = parseCupGroup(gCup);
    if (!num || !grp) continue;

    const key = `${num}|${grp}`;
    const teamKey = `${key}|${gTeam}`;

    // üî• LAGETS MATCHER = max GP f√∂r spelare i laget
    if (!teamGames[teamKey] || gGP > teamGames[teamKey]) {
      teamGames[teamKey] = gGP;
    }

    if (!perCupGroup[key]) perCupGroup[key] = [];
    perCupGroup[key].push({
      name: cleanSheetName(gName),
      team: gTeam,
      gp: gGP,
      sv: parseSVPclean(gSVP),
      svDisplay: formatSVP(gSVP)
    });
  }

  // 3) Vilka CUP+GRP spelade v√•r m√•lvakt i?
  const playerGoalieCups = goalies.map(g => {
    const num = parseCupNumber(g.TURNERING);
    const grp = parseCupGroup(g.TURNERING);
    return num && grp ? `${num}|${grp}` : null;
  }).filter(Boolean);

  const uniquePlayerCups = [...new Set(playerGoalieCups)];

  // 4) G√• igenom varje relevant CUP+GRUPP
  uniquePlayerCups.forEach(key => {
    const list = perCupGroup[key];
    if (!list) return;

    // üî• 40% + 3 GP-filter
    const filtered = list.filter(g => {
      const teamKey = `${key}|${g.team}`;
      const lagGP = teamGames[teamKey] || 0;
      if (lagGP === 0) return false;

      const gpOK = g.gp >= 3;
      const pctOK = g.gp >= Math.ceil(lagGP * 0.4);

      return gpOK && pctOK;
    });

    // M√•lvakten sj√§lv m√•ste kvalificera sig
    const playerRow = filtered.find(g => norm(g.name) === norm(cleanName));
    if (!playerRow) return;

    // Sortera
    const sorted = filtered.sort((a, b) => b.sv - a.sv);

    const placement = sorted.findIndex(g => norm(g.name) === norm(cleanName));
    if (placement === -1 || placement >= 3) return;

    const medal = ["ü•á", "ü•à", "ü•â"][placement];
    const [cupNum, grp] = key.split("|");
    const g = sorted[placement];

    // ‚úÖ KORRIGERAD TEXT + INGA FELAKTIGA WHITESPACE
    goalieSVBlock += `
      ${medal} <strong>${placement + 1}:a i m√•lvaktsligan i SEC ${cupNum} ${grp}</strong>
      (${g.svDisplay}) med <strong>${teamName(g.team)}</strong>.<br>
    `;
  });
}


        /* ‚ú® Bygg meritblock i ordning */
        if (pointRows.length || goalRows.length || goalieSVBlock) {

          meritBlockPersonal += `
            <div class="section-divider" style="margin-top:25px;">Personliga meriter</div>
            <div class="merit-list">
          `;

          // üìä Po√§ngligan
          pointRows.sort((a,b) => a.rank - b.rank).forEach(r => {
            const medal = r.rank === 1 ? "üéØ" : r.rank === 2 ? "ü•à" : "ü•â";
            meritBlockPersonal += `
              ${medal} <strong>${r.rank}:a i po√§ngligan i SEC ${r.cup}</strong> (${r.pts}p).<br>
            `;
          });

          // üèπ Skytteligan
          goalRows.sort((a,b) => a.rank - b.rank).forEach(r => {
            const medal = r.rank === 1 ? "üèπ" : r.rank === 2 ? "ü•à" : "ü•â";
            meritBlockPersonal += `
              ${medal} <strong>${r.rank}:a i skytteligan i SEC ${r.cup}</strong> (${r.g} m√•l).<br>
            `;
          });

          // üß± M√•lvakter ‚Äì SV%
          meritBlockPersonal += goalieSVBlock;

          meritBlockPersonal += `</div>`;
        }
      }

      /* ---- Slutlig sammans√§ttning ---- */
      let meritText = "";

      if (meritBlockGoldSilver || meritBlockPersonal) {
        meritText = `
          <div class="section-divider">Meriter</div>
          <div class="merit-list">${meritBlockGoldSilver}</div>
          ${meritBlockPersonal}
        `;
      }

      const cupsCount  = cupNumbers.length;
      const teamsCount = new Set(allRows.map(r => r.TEAM)).size;

      /* BIO ‚Äì ny text enligt din mall */
      let bioText = `
        <div style="margin-top:10px; margin-bottom:20px; color:#ddd; font-size:0.95rem; line-height:1.65;">
          <strong>${cleanName}</strong> √§r en <strong>${nationality}</strong> eHockey-spelare som gjorde sitt f√∂rsta
          framtr√§dande i <strong>${firstCup}</strong> f√∂r <strong>${firstTeam}</strong>.<br><br>
          Totalt har han deltagit i <strong>${cupsCount}</strong> upplagor av <strong>Svenska eHockey Cupen</strong> 
          och representerat <strong>${teamsCount}</strong> olika lag. Senast han spelade i SEC var i 
          <strong>${lastCup}</strong>, d√§r han representerade <strong>${lastTeam}</strong>.<br><br>
          Sammanlagt st√•r han p√• <strong>${totalGames}</strong> matcher i SEC.
          ${bestCupText}
          ${meritText}
        </div>
      `;

      /* Tabeller */
      let html = bioText;

      function cupSortValue(cupRaw) {
        if (!cupRaw) return 0;
        let c = String(cupRaw).replace("SEC", "").trim();
        let num = parseFloat(c);
        let phase = c.replace(/[0-9.]/g, "").trim(); // G eller S
        let phaseVal = phase === "G" ? 0 : 1;
        return num * 10 + phaseVal;
      }

      // Sortera utespelare
      skaters.sort((a, b) => cupSortValue(a.TURNERING) - cupSortValue(b.TURNERING));
      // sortera m√•lvakter
      goalies.sort((a, b) => cupSortValue(a.TURNERING) - cupSortValue(b.TURNERING));

      if (skaters.length) {
        html += `
          <div class="table-title">Utespelare</div>
          <div class="table-scroll stats-table">
            <table>
              <thead>
                <tr>
                  <th>TURNERING</th><th>TEAM</th><th>GP</th><th>G</th><th>A</th><th>PTS</th><th>PIM</th>
                </tr>
              </thead>
              <tbody>
        `;
        skaters.forEach(r => {
          html += `
            <tr>
              <td>${r.TURNERING}</td>
              <td>${teamName(r.TEAM)}</td>
              <td>${r.GP}</td>
              <td>${r.G}</td>
              <td>${r.A}</td>
              <td>${r.PTS}</td>
              <td>${r.PIM}</td>
            </tr>
          `;
        });
        html += `</tbody></table></div>`;
      }

      if (goalies.length) {
        html += `
          <div class="table-title">M√•lvakt</div>
          <div class="table-scroll stats-table">
            <table>
              <thead>
                <tr>
                  <th>TURNERING</th><th>TEAM</th><th>GP</th><th>SA</th><th>GA</th><th>SV</th><th>GAA</th><th>SV%</th><th>SO</th>
                </tr>
              </thead>
              <tbody>
        `;
        goalies.forEach(r => {
          html += `
            <tr>
              <td>${r.TURNERING}</td>
              <td>${teamName(r.TEAM)}</td>
              <td>${r.GP}</td>
              <td>${r.SA}</td>
              <td>${r.GA}</td>
              <td>${r.SV}</td>
              <td>${formatGAA(r.GAA)}</td>
              <td>${formatSVP(r.SVP)}</td>
              <td>${r.SO}</td>
            </tr>
          `;
        });
        html += `</tbody></table></div>`;
      }

      out.innerHTML = html;
      out.style.display = "block";
      loaderStats.style.display = "none";
// === G√ñR "SEC 1", "SEC 2", "SEC 3" ... KLICKBARA ===
function makeSecCupsClickable() {
  document.querySelectorAll("td, th").forEach(cell => {
    const text = cell.textContent.trim();

    // Matchar "SEC 1", "SEC 2 G", "SEC 19.5", osv.
    const match = text.match(/^SEC\s*([0-9.]+)/i);
    if (!match) return;

    const cupNum = match[1]; // 1 / 2 / 3 / 19.5 osv.
    const url = `https://sweehockey-svg.github.io/SEC/SEC${cupNum}.html`;

    cell.innerHTML = `<a href="${url}" style="color:#f5d86e; font-weight:600; text-decoration:none;">
                        ${text}
                      </a>`;
    cell.style.cursor = "pointer";
  });
}

// K√∂r funktionen n√§r statistiken har renderats
setTimeout(makeSecCupsClickable, 300);

    } catch (err) {
      console.error("Stats error:", err);
      loaderStats.style.display = "none";
      const out = document.getElementById("statsOutput");
      out.innerHTML = `<div class="no-stats">Fel vid laddning.</div>`;
      out.style.display = "block";
    }
  }

  /* INITIERA */
  loadAllPlayersFast();
  loadStats();


  </script>

</body>
</html>
