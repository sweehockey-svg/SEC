/* ===============================
         üèÜ Meriter
         =============================== */
      let meritText = "";

      winners.forEach(w => {
        const num = String(w.cup || "")
          .replace(/SEC/gi,"")
          .replace(/[^\d.]/g,"")
          .trim();
        if (!num) return;

        const row = allRows.find(r => {
          const turn = String(r.TURNERING || "")
            .replace(/SEC/gi,"")
            .replace(/[^\d.]/g,"")
            .trim();
          return turn === num;
        });
        if (!row) return;

        const tm = teamName(row.TEAM).toLowerCase();

        if (tm === String(w["1a"] || "").toLowerCase()) {
          meritText += `üèÜ <strong>M√§stare i SEC ${num}</strong> med <strong>${teamName(w["1a"])}</strong>.<br>`;
        }
        if (tm === String(w["2a"] || "").toLowerCase()) {
          meritText += `ü•à <strong>2:a i SEC ${num}</strong> med <strong>${teamName(w["2a"])}</strong>.<br>`;
        }
      });

      if (meritText.trim() !== "") {
        meritText = `
          <div class="merit-title">Meriter</div>
          <div class="merit-list">${meritText}</div>
        `;
      }

      // üìù BIO
      let bioText = `
        <div style="margin-top:10px; margin-bottom:20px; color:#ddd; font-size:0.95rem; line-height:1.65;">
          <strong>${cleanName}</strong> √§r en <strong>${nationality}</strong> eHockey-spelare som gjorde sitt f√∂rsta
          framtr√§dande i <strong>${firstCup}</strong> f√∂r <strong>${firstTeam}</strong>.<br><br>
      `;

      if (playedOnce) {
        bioText += `
          Han har endast deltagit i en SEC-turnering ‚Äì <strong>${firstCup}</strong>.<br><br>
        `;
      } else if (cups.length > 1) {
        bioText += `
          Totalt har han spelat i <strong>${cups.length}</strong> cuper och representerat 
          <strong>${new Set(allRows.map(r => r.TEAM)).size}</strong> lag. I senaste upplagan ‚Äì 
          <strong>${lastCup}</strong> ‚Äì spelade han f√∂r <strong>${lastTeam}</strong>.<br><br>
        `;
      }

      bioText += `
        Totalt st√•r han p√• <strong>${totalGames}</strong> matcher i SEC.
        ${bestCupText}
        ${meritText}
      `;

      // Tabeller
      let html = bioText;

      // UTESPELARE
      if (skaters.length) {
        html += `
          <div class="table-title">Utespelare</div>
          <div class="table-scroll stats-table">
            <table>
              <thead>
                <tr>
                  <th>TURNERING</th><th>TEAM</th><th>GP</th><th>G</th><th>A</th><th>PTS</th><th>PIM</th>
                </tr>
              </thead>
              <tbody>
        `;

        skaters.forEach(r => {
          html += `
            <tr>
              <td>${r.TURNERING}</td>
              <td>${teamName(r.TEAM)}</td>
              <td>${r.GP}</td>
              <td>${r.G}</td>
              <td>${r.A}</td>
              <td>${r.PTS}</td>
              <td>${r.PIM}</td>
            </tr>
          `;
        });

        html += `</tbody></table></div>`;
      }

      // M√ÖLVAKTER
      if (goalies.length) {
        html += `
          <div class="table-title">M√•lvakt</div>
          <div class="table-scroll stats-table">
            <table>
              <thead>
                <tr>
                  <th>TURNERING</th><th>TEAM</th><th>GP</th><th>SA</th><th>GA</th><th>SV</th><th>GAA</th><th>SV%</th><th>SO</th>
                </tr>
              </thead>
              <tbody>
        `;

        goalies.forEach(r => {
          html += `
            <tr>
              <td>${r.TURNERING}</td>
              <td>${teamName(r.TEAM)}</td>
              <td>${r.GP}</td>
              <td>${r.SA}</td>
              <td>${r.GA}</td>
              <td>${r.SV}</td>
              <td>${formatGAA(r.GAA)}</td>
              <td>${formatSVP(r.SVP)}</td>
              <td>${r.SO}</td>
            </tr>
          `;
        });

        html += `</tbody></table></div>`;
      }

      out.innerHTML = html;
      out.style.display = "block";
      loaderStats.style.display = "none";

    } catch (err) {
      console.error("Stats error:", err);
      loaderStats.style.display = "none";
      out.innerHTML = `<div class="no-stats">Fel vid laddning.</div>`;
      out.style.display = "block";
    }
  }

  /* INITIERA */
  loadAllPlayersFast();
  loadStats();
</script>

</body>
</html>
