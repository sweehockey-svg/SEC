<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Svenska Po√§ngligan</title>

<!-- üîπ STIL -->
<style>
body {
  margin: 0;
  font-family: Inter, system-ui, Arial, sans-serif;
  background: #ffffff;
}

.ecl-tabs {
  display: flex;
  gap: 6px;
  margin: 10px 0 16px;
  flex-wrap: wrap;
}
.ecl-tab {
  border: none;
  padding: 8px 14px;
  border-radius: 999px;
  font-size: 14px;
  cursor: pointer;
  background: #f1f3fa;
  color: #202742;
  font-weight: 600;
}
.ecl-tab.active {
  background: #101b40;
  color: #f7e0a2;
}

.division { display: none; }
.division.active { display: block; }

.header-box {
  display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
  margin: 10px 0 20px; gap: 12px;
}
.header-box h2 {
  font-size: 24px; font-weight: 800; color: #0b1a49;
  margin: 0;
}
.header-box input[type="text"] {
  padding: 10px 14px; font-size: 15px; border: 1px solid #ccc;
  border-radius: 10px; min-width: 240px; outline: none;
}
.header-box input[type="text"]:focus {
  border-color: #0b1a49; box-shadow: 0 0 0 2px rgba(11,26,73,.15);
}

/* Top 3 */
.top3-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px;
  margin-bottom: 18px;
}
.player-card {
  background: #ffffff;
  border-radius: 16px;
  padding: 14px 16px;
  box-shadow: 0 4px 16px rgba(0,0,0,.06);
}
.player-img-wrap {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-bottom: 10px;
}
.player-img {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  object-fit: cover;
  box-shadow: 0 3px 10px rgba(0,0,0,.15);
}

/* Tabell */
.table-container {
  background: #fff; border-radius: 12px; overflow-x: auto;
  box-shadow: 0 6px 18px rgba(0,0,0,.08);
}
.table-container table {
  width: 100%; border-collapse: separate; border-spacing: 0;
  font: 15px Inter, system-ui;
}
.table-container thead th {
  position: sticky; top: 0; background: #101b40; color: #d6b15f;
  padding: 12px 10px; border-bottom: 1px solid #1f2a44;
}
.table-container tbody td {
  padding: 12px 10px; border-bottom: 1px solid #e9eef5;
}

</style>
</head>

<body>

<!-- üîπ TABS -->
<div class="ecl-tabs">
  <button class="ecl-tab active" data-division="elite">Elite</button>
  <button class="ecl-tab" data-division="pro">Pro</button>
  <button class="ecl-tab" data-division="lite">Lite</button>
  <button class="ecl-tab" data-division="core">Core</button>
  <button class="ecl-tab" data-division="neo">Neo</button>
</div>

<!-- üîπ ELITE -->
<div id="division-elite" class="division active">
  <div class="header-box">
    <h2>üèÜ ECL 26 Winter ‚Äì Elite Po√§ngliga (Svenska spelare)</h2>
    <input type="text" id="search-elite" placeholder="üîç S√∂k spelare eller lag...">
  </div>
  <div id="top3-elite" class="top3-container"></div>
  <div id="table-elite" class="table-container"></div>
  <p id="updated-elite" class="lastUpdated"></p>
</div>

<!-- üîπ PRO -->
<div id="division-pro" class="division">
  <div class="header-box">
    <h2>üèÜ ECL 26 Winter ‚Äì Pro Po√§ngliga (Svenska spelare)</h2>
    <input type="text" id="search-pro" placeholder="üîç S√∂k spelare eller lag...">
  </div>
  <div id="top3-pro" class="top3-container"></div>
  <div id="table-pro" class="table-container"></div>
  <p id="updated-pro" class="lastUpdated"></p>
</div>

<!-- üîπ LITE -->
<div id="division-lite" class="division">
  <div class="header-box">
    <h2>üèÜ ECL 26 Winter ‚Äì Lite Po√§ngliga (Svenska spelare)</h2>
    <input type="text" id="search-lite" placeholder="üîç S√∂k spelare eller lag...">
  </div>
  <div id="top3-lite" class="top3-container"></div>
  <div id="table-lite" class="table-container"></div>
  <p id="updated-lite" class="lastUpdated"></p>
</div>

<!-- üîπ CORE -->
<div id="division-core" class="division">
  <div class="header-box">
    <h2>üèÜ ECL 26 Winter ‚Äì Core Po√§ngliga (Svenska spelare)</h2>
    <input type="text" id="search-core" placeholder="üîç S√∂k spelare eller lag...">
  </div>
  <div id="top3-core" class="top3-container"></div>
  <div id="table-core" class="table-container"></div>
  <p id="updated-core" class="lastUpdated"></p>
</div>

<!-- üîπ NEO -->
<div id="division-neo" class="division">
  <div class="header-box">
    <h2>üèÜ ECL 26 Winter ‚Äì Neo Po√§ngliga (Svenska spelare)</h2>
    <input type="text" id="search-neo" placeholder="üîç S√∂k spelare eller lag...">
  </div>
  <div id="top3-neo" class="top3-container"></div>
  <div id="table-neo" class="table-container"></div>
  <p id="updated-neo" class="lastUpdated"></p>
</div>

<!-- üîπ SCRIPT -->
<script>
(function(){

/* ---------------- DEFAULT BILD ---------------- */
const DEFAULT_IMG = "https://drive.google.com/uc?export=view&id=1VAa79pJ-QbyeliY60autf914z6SBwmhp";

/* ---------------- GOOGLE SHEET ---------------- */
const SHEET_ID = "1toag5J7vMW0CEmtsrqByPJMJn6e-U5hOzZaKWoXnpxY";
function sheetCSV(sheet) {
  return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${sheet}`;
}

const SHEETS = {
  cards: sheetCSV("Spelarkort"),
  elite: sheetCSV("Elitepo√§ngliga"),
  pro: sheetCSV("Propo√§ngliga"),
  lite: sheetCSV("Litepo√§ngliga"),
  core: sheetCSV("Corepo√§ngliga"),
  neo: sheetCSV("Neopo√§ngliga")
};

/* ---------------- NORMALISERING ---------------- */
function normalizeName(str){
  if (!str) return "";
  return str.normalize("NFKD")
    .replace(/[\u0300-\u036f]/g,"")
    .replace(/[^\w\s]/g,"")
    .trim()
    .toLowerCase();
}

/* ---------------- CSV PARSER ---------------- */
function parseCSV(csv){
  return csv.split("\n").map(r=>r.split(",").map(c=>c.trim()));
}

/* ---------------- LADDA SPELARBILDER ---------------- */
let playerImgMap = null;

async function loadPlayerImages(){
  if (playerImgMap) return playerImgMap;

  const txt = await fetch(SHEETS.cards).then(r=>r.text());
  const rows = parseCSV(txt);
  rows.shift();

  const map = {};

  rows.forEach(r=>{
    const name = normalizeName(r[0] || "");
    const link = r[1] || "";
    const id   = r[2] || "";

    let url = DEFAULT_IMG;

    if (id) {
      url = `https://drive.google.com/uc?export=view&id=${id}`;
    } else if (link.includes("/d/")) {
      const m = link.match(/\/d\/(.*?)\//);
      if (m) url = `https://drive.google.com/uc?export=view&id=${m[1]}`;
    }

    map[name] = url;
  });

  playerImgMap = map;
  return map;
}

/* ---------------- LADDA DIVISION ---------------- */
async function loadDivision(key){
  const cfg = {
    elite: { url: SHEETS.elite, top: "top3-elite", table: "table-elite" },
    pro:   { url: SHEETS.pro,   top: "top3-pro",   table: "table-pro" },
    lite:  { url: SHEETS.lite,  top: "top3-lite",  table: "table-lite" },
    core:  { url: SHEETS.core,  top: "top3-core",  table: "table-core" },
    neo:   { url: SHEETS.neo,   top: "top3-neo",   table: "table-neo" }
  }[key];

  if (!cfg) return;

  const imgMap = await loadPlayerImages();
  const csv = await fetch(cfg.url).then(r=>r.text());
  const rows = parseCSV(csv);

  const header = rows.shift();
  const data = rows.map(r => {
    const psn = r[0];
    const img = imgMap[normalizeName(psn)] || DEFAULT_IMG;
    return {
      psn,
      team: r[1],
      games: Number(r[2]),
      goals: Number(r[3]),
      assists: Number(r[4]),
      points: Number(r[5]),
      img
    };
  });

  data.sort((a,b)=>b.points - a.points);

  renderTop3(data.slice(0,3), document.getElementById(cfg.top));
  renderTable(data, header, document.getElementById(cfg.table));
}

/* ---------------- TOP 3 ---------------- */
function renderTop3(players, host){
  host.innerHTML = players.map((p,i)=>`
    <div class="player-card">
      <div class="player-img-wrap">
        <img class="player-img" src="${p.img}"
             onerror="this.src='${DEFAULT_IMG}'">
      </div>
      <div class="player-card-header">
        <div>
          <div class="player-name">${p.psn}</div>
          <div class="player-team">${p.team}</div>
        </div>
        <div class="player-rank">#${i+1}</div>
      </div>
      <div class="player-points">${p.points} po√§ng</div>
      <div class="player-ga">G ${p.goals} ‚Ä¢ A ${p.assists} ‚Ä¢ GP ${p.games}</div>
    </div>
  `).join("");
}

/* ---------------- TABELL ---------------- */
function renderTable(data, header, host){
  host.innerHTML = `
    <table>
      <thead><tr>${header.map(h=>`<th>${h}</th>`).join("")}</tr></thead>
      <tbody>
        ${data.map(p=>`
          <tr>
            <td>${p.psn}</td>
            <td>${p.team}</td>
            <td>${p.games}</td>
            <td>${p.goals}</td>
            <td>${p.assists}</td>
            <td>${p.points}</td>
          </tr>
        `).join("")}
      </tbody>
    </table>
  `;
}

/* ---------------- TABS ---------------- */
document.querySelectorAll(".ecl-tab").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".ecl-tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    document.querySelectorAll(".division").forEach(div=>div.classList.remove("active"));
    document.getElementById("division-"+btn.dataset.division).classList.add("active");

    loadDivision(btn.dataset.division);
  });
});

/* ---------------- Ladda Elite direkt ---------------- */
loadDivision("elite");

})();
</script>

</body>
</html>
